// -*- C++ -*-
#ifndef ALIEN_INDEXMANAGER_SIMPLEABSTRACTFAMILY_H
#define ALIEN_INDEXMANAGER_SIMPLEABSTRACTFAMILY_H
/* Author : havep at Mon Jan 14 18:30:40 2013
 * Generated by createNew
 */

#include "alien/AlienArcaneToolsPrecomp.h"
#include "alien/arcane_tools/IIndexManager.h"

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

namespace Alien {

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

namespace ArcaneTools {

  /*---------------------------------------------------------------------------*/
  /*---------------------------------------------------------------------------*/

  /* Dans cette implémentation, implicitement le localId du i_ème item est i */
  class ALIEN_ARCANE_TOOLS_EXPORT SimpleAbstractFamily
      : public IIndexManager::IAbstractFamily
  {
   public:
    //! Construit une famille à partir des uniqueIds connus localement et leur
    //! propriétaire
    /*! L'indexation localId suit l'ordre des uniqueIds fournis */
    SimpleAbstractFamily(const Arccore::ConstArrayView<Arccore::Int64> uniqueIds,
        const Arccore::ConstArrayView<Arccore::Integer> owners, IIndexManager* manager);

    //! Construit une famille à partir des uniqueIds locaux
    /*! Les items locaux sont indexés en premier, puis suivent ceux des autres
     * processeurs. Les propriétaires sont reconstruits en parallèle */
    SimpleAbstractFamily(
        const Arccore::ConstArrayView<Arccore::Int64> uniqueIds, IIndexManager* manager);

    virtual ~SimpleAbstractFamily();

   public:
    IIndexManager::IAbstractFamily* clone() const
    {
      return new SimpleAbstractFamily(*this);
    }

   public:
    Arccore::Int32 maxLocalId() const { return m_unique_ids.size(); }
    void uniqueIdToLocalId(Arccore::ArrayView<Arccore::Int32> localIds,
        Arccore::ConstArrayView<Arccore::Int64> uniqueIds) const;
    IAbstractFamily::Item item(Arccore::Int32 localId) const;
    Arccore::SharedArray<Arccore::Integer> owners(
        Arccore::ConstArrayView<Arccore::Int32> localIds) const;
    Arccore::SharedArray<Arccore::Int64> uids(
        Arccore::ConstArrayView<Arccore::Int32> localIds) const;
    Arccore::SharedArray<Arccore::Int32> allLocalIds() const;

   private:
    IIndexManager* m_manager;
    Arccore::UniqueArray<Arccore::Int64> m_unique_ids;
    Arccore::UniqueArray<Arccore::Integer> m_owners;
  };

  /*---------------------------------------------------------------------------*/
  /*---------------------------------------------------------------------------*/

} // namespace Alien

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/
}

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#endif /* ALIEN_INDEXMANAGER_SIMPLEABSTRACTFAMILY_H */
